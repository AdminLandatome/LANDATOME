<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landatome â€” Quiz TrigonomÃ©trie</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --card: #1a2235;
    --accent: #e8c547;
    --accent2: #4fc3f7;
    --accent3: #f06292;
    --text: #e8eaf0;
    --muted: #6b7a99;
    --correct: #4caf50;
    --wrong: #ef5350;
    --radius: 12px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    background-image: 
      radial-gradient(ellipse at 20% 20%, rgba(79,195,247,0.06) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 80%, rgba(232,197,71,0.06) 0%, transparent 60%);
  }

  header {
    text-align: center;
    padding: 40px 0 20px;
  }

  header h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.2rem, 5vw, 3.5rem);
    font-weight: 900;
    color: var(--accent);
    letter-spacing: -1px;
    line-height: 1;
  }

  header p {
    color: var(--muted);
    font-size: 0.85rem;
    margin-top: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .circle-deco {
    position: fixed;
    border-radius: 50%;
    border: 1px solid rgba(79,195,247,0.08);
    pointer-events: none;
  }
  .circle-deco:nth-child(1) { width: 400px; height: 400px; top: -100px; left: -100px; }
  .circle-deco:nth-child(2) { width: 300px; height: 300px; bottom: -80px; right: -80px; border-color: rgba(232,197,71,0.08); }

  /* SETUP SCREEN */
  #setup-screen {
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--radius);
    padding: 40px;
    max-width: 560px;
    width: 100%;
    margin: 30px auto;
    animation: fadeIn 0.4s ease;
  }

  #setup-screen h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.4rem;
    color: var(--accent2);
    margin-bottom: 24px;
  }

  .option-group {
    margin-bottom: 20px;
  }

  .option-group label {
    display: block;
    font-size: 0.8rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 10px;
  }

  .theme-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .theme-btn {
    background: var(--surface);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
  }

  .theme-btn:hover, .theme-btn.active {
    border-color: var(--accent2);
    background: rgba(79,195,247,0.08);
    color: var(--accent2);
  }

  .qty-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .qty-btn {
    background: var(--surface);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 8px;
    padding: 10px 20px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .qty-btn:hover, .qty-btn.active {
    border-color: var(--accent);
    background: rgba(232,197,71,0.08);
    color: var(--accent);
  }

  .start-btn {
    display: block;
    width: 100%;
    margin-top: 30px;
    padding: 16px;
    background: var(--accent);
    color: #0a0e1a;
    border: none;
    border-radius: var(--radius);
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.2s;
  }

  .start-btn:hover {
    background: #f0d060;
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(232,197,71,0.25);
  }

  /* QUIZ SCREEN */
  #quiz-screen {
    max-width: 680px;
    width: 100%;
    margin: 20px auto;
    animation: fadeIn 0.4s ease;
    display: none;
  }

  .progress-bar-wrap {
    background: var(--surface);
    border-radius: 999px;
    height: 6px;
    margin-bottom: 24px;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    border-radius: 999px;
    transition: width 0.4s ease;
  }

  .quiz-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.78rem;
    color: var(--muted);
    margin-bottom: 20px;
  }

  .score-display {
    color: var(--accent);
    font-weight: 700;
  }

  .question-card {
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--radius);
    padding: 32px;
    margin-bottom: 20px;
    animation: slideIn 0.3s ease;
  }

  .question-type {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--accent3);
    margin-bottom: 12px;
  }

  .question-text {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1rem, 2.5vw, 1.25rem);
    line-height: 1.5;
    color: var(--text);
  }

  .question-text .math {
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.95em;
  }

  .answers-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 20px;
  }

  @media (max-width: 480px) {
    .answers-grid { grid-template-columns: 1fr; }
  }

  .answer-btn {
    background: var(--surface);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--radius);
    padding: 16px 18px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    position: relative;
    line-height: 1.4;
  }

  .answer-btn:hover:not(:disabled) {
    border-color: var(--accent2);
    background: rgba(79,195,247,0.06);
    transform: translateY(-1px);
  }

  .answer-btn.correct {
    border-color: var(--correct);
    background: rgba(76,175,80,0.12);
    color: #81c784;
  }

  .answer-btn.wrong {
    border-color: var(--wrong);
    background: rgba(239,83,80,0.12);
    color: #ef9a9a;
  }

  .answer-btn.reveal-correct {
    border-color: var(--correct);
    background: rgba(76,175,80,0.06);
    color: #81c784;
  }

  .answer-btn:disabled { cursor: default; }

  .answer-label {
    display: inline-block;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: rgba(255,255,255,0.06);
    text-align: center;
    line-height: 22px;
    font-size: 0.72rem;
    font-weight: 700;
    margin-right: 8px;
    color: var(--muted);
  }

  .correct .answer-label { background: rgba(76,175,80,0.3); color: #81c784; }
  .wrong .answer-label { background: rgba(239,83,80,0.3); color: #ef9a9a; }
  .reveal-correct .answer-label { background: rgba(76,175,80,0.2); color: #81c784; }

  .feedback-box {
    background: var(--surface);
    border-left: 3px solid var(--accent2);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 16px 20px;
    font-size: 0.85rem;
    color: var(--muted);
    line-height: 1.6;
    margin-top: 16px;
    display: none;
  }

  .feedback-box.visible { display: block; animation: fadeIn 0.3s ease; }
  .feedback-box.correct-fb { border-color: var(--correct); }
  .feedback-box.wrong-fb { border-color: var(--wrong); }

  .feedback-box strong { color: var(--text); }
  .feedback-box .math { color: var(--accent); font-family: 'JetBrains Mono', monospace; }

  .next-btn {
    display: block;
    width: 100%;
    padding: 14px;
    background: transparent;
    border: 1px solid var(--accent);
    border-radius: var(--radius);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.2s;
    margin-top: 12px;
    display: none;
  }

  .next-btn:hover {
    background: rgba(232,197,71,0.08);
  }

  /* RESULTS SCREEN */
  #results-screen {
    max-width: 560px;
    width: 100%;
    margin: 30px auto;
    display: none;
    animation: fadeIn 0.5s ease;
    text-align: center;
  }

  .score-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    border: 3px solid var(--accent);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0 auto 30px;
    box-shadow: 0 0 40px rgba(232,197,71,0.15);
  }

  .score-circle .big-num {
    font-family: 'Playfair Display', serif;
    font-size: 2.8rem;
    font-weight: 900;
    color: var(--accent);
    line-height: 1;
  }

  .score-circle .big-denom {
    font-size: 0.85rem;
    color: var(--muted);
  }

  #results-screen h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    margin-bottom: 8px;
  }

  #results-screen .subtitle {
    color: var(--muted);
    font-size: 0.85rem;
    margin-bottom: 30px;
  }

  .results-breakdown {
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 20px;
    text-align: left;
  }

  .results-breakdown h3 {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 14px;
  }

  .breakdown-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 0.82rem;
  }

  .breakdown-item:last-child { border-bottom: none; }
  .breakdown-item .bi-score { font-weight: 700; }
  .breakdown-item .bi-score.good { color: var(--correct); }
  .breakdown-item .bi-score.bad { color: var(--wrong); }
  .breakdown-item .bi-score.ok { color: var(--accent); }

  .restart-btn {
    display: inline-block;
    padding: 14px 40px;
    background: var(--accent);
    color: #0a0e1a;
    border: none;
    border-radius: var(--radius);
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .restart-btn:hover {
    background: #f0d060;
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(232,197,71,0.25);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .tick { color: var(--correct); margin-right: 6px; }
  .cross { color: var(--wrong); margin-right: 6px; }
</style>
</head>
<body>

<div class="circle-deco"></div>
<div class="circle-deco"></div>

<header>
  <h1>Landatome Trigo</h1>
  <p>Quiz â€” Angles remarquables &amp; TrigonomÃ©trie</p>
</header>

<!-- SETUP -->
<div id="setup-screen">
  <h2>Configurer le quiz</h2>

  <div class="option-group">
    <label>ThÃ¨mes Ã  inclure</label>
    <div class="theme-grid">
      <button class="theme-btn active" data-theme="reduction">RÃ©duction d'angles</button>
      <button class="theme-btn active" data-theme="valeurs">Valeurs cos/sin</button>
      <button class="theme-btn active" data-theme="symetrie">RÃ¨gles de symÃ©trie</button>
      <button class="theme-btn active" data-theme="conversion">Rad â†” DegrÃ©s</button>
    </div>
  </div>

  <div class="option-group">
    <label>Nombre de questions</label>
    <div class="qty-row">
      <button class="qty-btn" data-qty="5">5</button>
      <button class="qty-btn active" data-qty="10">10</button>
      <button class="qty-btn" data-qty="15">15</button>
      <button class="qty-btn" data-qty="20">20</button>
    </div>
  </div>

  <button class="start-btn" id="start-btn">Commencer â†’</button>
</div>

<!-- QUIZ -->
<div id="quiz-screen">
  <div class="quiz-meta">
    <span id="q-counter">Question 1 / 10</span>
    <span class="score-display" id="score-display">Score : 0</span>
  </div>
  <div class="progress-bar-wrap">
    <div class="progress-bar" id="progress-bar" style="width:0%"></div>
  </div>
  <div class="question-card" id="question-card">
    <div class="question-type" id="q-type"></div>
    <div class="question-text" id="q-text"></div>
    <div class="answers-grid" id="answers-grid"></div>
    <div class="feedback-box" id="feedback-box"></div>
  </div>
  <button class="next-btn" id="next-btn">Question suivante â†’</button>
</div>

<!-- RESULTS -->
<div id="results-screen">
  <div class="score-circle">
    <div class="big-num" id="final-score-num">0</div>
    <div class="big-denom" id="final-score-denom">/ 10</div>
  </div>
  <h2 id="result-title">Bien jouÃ© !</h2>
  <p class="subtitle" id="result-subtitle">Continue comme Ã§a.</p>
  <div class="results-breakdown" id="breakdown"></div>
  <button class="restart-btn" id="restart-btn">Rejouer</button>
</div>

<script>
// ======================================================
//  BANQUE DE QUESTIONS
// ======================================================

const PI = 'Ï€';

// Helper: formatage
function m(s) { return `<span class="math">${s}</span>`; }

// --- SymÃ©tries ---
const symetryRules = [
  { q: `ComplÃ©ter : ${m('cos(Ï€ âˆ’ x)')} = ...`, correct: m('âˆ’cos(x)'), wrong: [m('cos(x)'), m('âˆ’sin(x)'), m('sin(x)')], 
    explain: `Par symÃ©trie par rapport Ã  l'axe des ordonnÃ©es : ${m('cos(Ï€âˆ’x) = âˆ’cos(x)')}` },
  { q: `ComplÃ©ter : ${m('sin(Ï€ âˆ’ x)')} = ...`, correct: m('sin(x)'), wrong: [m('âˆ’sin(x)'), m('cos(x)'), m('âˆ’cos(x)')],
    explain: `Par symÃ©trie : ${m('sin(Ï€âˆ’x) = sin(x)')}` },
  { q: `ComplÃ©ter : ${m('cos(âˆ’x)')} = ...`, correct: m('cos(x)'), wrong: [m('âˆ’cos(x)'), m('sin(x)'), m('âˆ’sin(x)')],
    explain: `Le cosinus est une fonction paire : ${m('cos(âˆ’x) = cos(x)')}` },
  { q: `ComplÃ©ter : ${m('sin(âˆ’x)')} = ...`, correct: m('âˆ’sin(x)'), wrong: [m('sin(x)'), m('cos(x)'), m('âˆ’cos(x)')],
    explain: `Le sinus est une fonction impaire : ${m('sin(âˆ’x) = âˆ’sin(x)')}` },
  { q: `ComplÃ©ter : ${m('cos(x + Ï€)')} = ...`, correct: m('âˆ’cos(x)'), wrong: [m('cos(x)'), m('sin(x)'), m('âˆ’sin(x)')],
    explain: `DÃ©calage de Ï€ : ${m('cos(x+Ï€) = âˆ’cos(x)')}` },
  { q: `ComplÃ©ter : ${m('sin(x + Ï€)')} = ...`, correct: m('âˆ’sin(x)'), wrong: [m('sin(x)'), m('cos(x)'), m('âˆ’cos(x)')],
    explain: `DÃ©calage de Ï€ : ${m('sin(x+Ï€) = âˆ’sin(x)')}` },
  { q: `ComplÃ©ter : ${m('cos(2Ï€ âˆ’ x)')} = ...`, correct: m('cos(x)'), wrong: [m('âˆ’cos(x)'), m('sin(x)'), m('âˆ’sin(x)')],
    explain: `${m('cos(2Ï€âˆ’x) = cos(âˆ’x) = cos(x)')} (cosinus est pair et 2Ï€-pÃ©riodique)` },
  { q: `ComplÃ©ter : ${m('sin(2Ï€ âˆ’ x)')} = ...`, correct: m('âˆ’sin(x)'), wrong: [m('sin(x)'), m('cos(x)'), m('âˆ’cos(x)')],
    explain: `${m('sin(2Ï€âˆ’x) = sin(âˆ’x) = âˆ’sin(x)')} (sinus est impair)` },
  { q: `ComplÃ©ter : ${m('cos(Ï€/2 âˆ’ x)')} = ...`, correct: m('sin(x)'), wrong: [m('cos(x)'), m('âˆ’sin(x)'), m('âˆ’cos(x)')],
    explain: `Relation de complÃ©mentaritÃ© : ${m('cos(Ï€/2âˆ’x) = sin(x)')}` },
  { q: `ComplÃ©ter : ${m('sin(Ï€/2 âˆ’ x)')} = ...`, correct: m('cos(x)'), wrong: [m('sin(x)'), m('âˆ’cos(x)'), m('âˆ’sin(x)')],
    explain: `Relation de complÃ©mentaritÃ© : ${m('sin(Ï€/2âˆ’x) = cos(x)')}` },
  { q: `ComplÃ©ter : ${m('cos(Ï€/2 + x)')} = ...`, correct: m('âˆ’sin(x)'), wrong: [m('sin(x)'), m('cos(x)'), m('âˆ’cos(x)')],
    explain: `${m('cos(Ï€/2+x) = âˆ’sin(x)')}` },
  { q: `ComplÃ©ter : ${m('sin(Ï€/2 + x)')} = ...`, correct: m('cos(x)'), wrong: [m('âˆ’cos(x)'), m('sin(x)'), m('âˆ’sin(x)')],
    explain: `${m('sin(Ï€/2+x) = cos(x)')}` },
  { q: `ComplÃ©ter : ${m('tan(Ï€ + x)')} = ...`, correct: m('tan(x)'), wrong: [m('âˆ’tan(x)'), m('cot(x)'), m('1/tan(x)')],
    explain: `La tangente est Ï€-pÃ©riodique : ${m('tan(Ï€+x) = tan(x)')}` },
];

// --- Valeurs cos/sin ---
const valuesQs = [
  { q: `Quelle est la valeur de ${m('cos(0)')} ?`, correct: m('1'), wrong: [m('0'), m('âˆ’1'), m('1/2')],
    explain: `${m('cos(0) = 1')} â€” le point (1, 0) est sur le cercle trigonomÃ©trique.` },
  { q: `Quelle est la valeur de ${m('sin(0)')} ?`, correct: m('0'), wrong: [m('1'), m('âˆ’1'), m('âˆš2/2')],
    explain: `${m('sin(0) = 0')}` },
  { q: `Quelle est la valeur de ${m('cos(Ï€/6)')} ?`, correct: m('âˆš3/2'), wrong: [m('1/2'), m('âˆš2/2'), m('1')],
    explain: `${m('cos(Ï€/6) = cos(30Â°) = âˆš3/2')}` },
  { q: `Quelle est la valeur de ${m('sin(Ï€/6)')} ?`, correct: m('1/2'), wrong: [m('âˆš3/2'), m('âˆš2/2'), m('0')],
    explain: `${m('sin(Ï€/6) = sin(30Â°) = 1/2')}` },
  { q: `Quelle est la valeur de ${m('cos(Ï€/4)')} ?`, correct: m('âˆš2/2'), wrong: [m('1/2'), m('âˆš3/2'), m('1')],
    explain: `${m('cos(Ï€/4) = cos(45Â°) = âˆš2/2 â‰ˆ 0.707')}` },
  { q: `Quelle est la valeur de ${m('sin(Ï€/4)')} ?`, correct: m('âˆš2/2'), wrong: [m('1/2'), m('âˆš3/2'), m('âˆ’âˆš2/2')],
    explain: `${m('sin(Ï€/4) = sin(45Â°) = âˆš2/2')}` },
  { q: `Quelle est la valeur de ${m('cos(Ï€/3)')} ?`, correct: m('1/2'), wrong: [m('âˆš3/2'), m('âˆš2/2'), m('0')],
    explain: `${m('cos(Ï€/3) = cos(60Â°) = 1/2')}` },
  { q: `Quelle est la valeur de ${m('sin(Ï€/3)')} ?`, correct: m('âˆš3/2'), wrong: [m('1/2'), m('âˆš2/2'), m('1')],
    explain: `${m('sin(Ï€/3) = sin(60Â°) = âˆš3/2')}` },
  { q: `Quelle est la valeur de ${m('cos(Ï€/2)')} ?`, correct: m('0'), wrong: [m('1'), m('âˆ’1'), m('1/2')],
    explain: `${m('cos(Ï€/2) = cos(90Â°) = 0')}` },
  { q: `Quelle est la valeur de ${m('sin(Ï€/2)')} ?`, correct: m('1'), wrong: [m('0'), m('âˆ’1'), m('âˆš2/2')],
    explain: `${m('sin(Ï€/2) = sin(90Â°) = 1')}` },
  { q: `Quelle est la valeur de ${m('cos(Ï€)')} ?`, correct: m('âˆ’1'), wrong: [m('1'), m('0'), m('âˆ’âˆš2/2')],
    explain: `${m('cos(Ï€) = cos(180Â°) = âˆ’1')}` },
  { q: `Quelle est la valeur de ${m('sin(Ï€)')} ?`, correct: m('0'), wrong: [m('1'), m('âˆ’1'), m('âˆš3/2')],
    explain: `${m('sin(Ï€) = sin(180Â°) = 0')}` },
  { q: `Quelle est la valeur de ${m('cos(3Ï€/2)')} ?`, correct: m('0'), wrong: [m('1'), m('âˆ’1'), m('âˆ’âˆš2/2')],
    explain: `${m('cos(3Ï€/2) = cos(270Â°) = 0')}` },
  { q: `Quelle est la valeur de ${m('sin(3Ï€/2)')} ?`, correct: m('âˆ’1'), wrong: [m('0'), m('1'), m('âˆ’âˆš2/2')],
    explain: `${m('sin(3Ï€/2) = sin(270Â°) = âˆ’1')}` },
  { q: `Quelle est la valeur de ${m('cos(2Ï€)')} ?`, correct: m('1'), wrong: [m('0'), m('âˆ’1'), m('âˆš2/2')],
    explain: `${m('cos(2Ï€) = cos(360Â°) = 1')} â€” retour au point de dÃ©part.` },
  { q: `Quelle est la valeur de ${m('cos(âˆ’Ï€/3)')} ?`, correct: m('1/2'), wrong: [m('âˆ’1/2'), m('âˆš3/2'), m('âˆ’âˆš3/2')],
    explain: `Le cosinus est pair : ${m('cos(âˆ’Ï€/3) = cos(Ï€/3) = 1/2')}` },
  { q: `Quelle est la valeur de ${m('sin(âˆ’Ï€/4)')} ?`, correct: m('âˆ’âˆš2/2'), wrong: [m('âˆš2/2'), m('1/2'), m('âˆ’1/2')],
    explain: `Le sinus est impair : ${m('sin(âˆ’Ï€/4) = âˆ’sin(Ï€/4) = âˆ’âˆš2/2')}` },
  { q: `Quelle est la valeur de ${m('sin(5Ï€/6)')} ?`, correct: m('1/2'), wrong: [m('âˆ’1/2'), m('âˆš3/2'), m('âˆ’âˆš3/2')],
    explain: `${m('sin(5Ï€/6) = sin(Ï€ âˆ’ Ï€/6) = sin(Ï€/6) = 1/2')}` },
  { q: `Quelle est la valeur de ${m('cos(5Ï€/4)')} ?`, correct: m('âˆ’âˆš2/2'), wrong: [m('âˆš2/2'), m('âˆ’1/2'), m('âˆ’âˆš3/2')],
    explain: `${m('cos(5Ï€/4) = cos(Ï€ + Ï€/4) = âˆ’cos(Ï€/4) = âˆ’âˆš2/2')}` },
  { q: `Quelle est la valeur de ${m('sin(7Ï€/6)')} ?`, correct: m('âˆ’1/2'), wrong: [m('1/2'), m('âˆ’âˆš3/2'), m('âˆš3/2')],
    explain: `${m('sin(7Ï€/6) = sin(Ï€ + Ï€/6) = âˆ’sin(Ï€/6) = âˆ’1/2')}` },
];

// --- RÃ©duction d'angle dans [âˆ’Ï€ ; Ï€[ ou [0 ; 2Ï€] ---
const reductionQs = [
  { q: `Ã€ quelle valeur de ${m('[âˆ’Ï€ ; Ï€[')} est associÃ©e ${m('13Ï€/2')} rad ?`, correct: m('âˆ’Ï€/2'), wrong: [m('Ï€/2'), m('Ï€'), m('3Ï€/2')],
    explain: `${m('13Ï€/2 = 6Ï€ + Ï€/2 = 3Ã—2Ï€ + Ï€/2')}, donc congru Ã  ${m('Ï€/2')}. Mais ${m('Ï€/2 âˆˆ [âˆ’Ï€;Ï€[')}... Attention : ${m('13Ï€/2 mod 2Ï€ = Ï€/2')}, et ${m('Ï€/2 â†” âˆ’Ï€/2')} non. Recalcul : 13/2 = 6.5, 6.5 âˆ’ 3Ã—2 = 6.5âˆ’6=0.5, donc ${m('Ï€/2')}. On ramÃ¨ne dans [âˆ’Ï€;Ï€[ : ${m('Ï€/2 âˆˆ [âˆ’Ï€;Ï€[')} est valide. RÃ©ponse : ${m('Ï€/2')}. <em>Correction de l'Ã©noncÃ© : la rÃ©ponse exacte est Ï€/2, qui appartient bien Ã  [âˆ’Ï€;Ï€[.</em>` },
  { q: `Ã€ quelle valeur de ${m('[0 ; 2Ï€[')} est associÃ©e ${m('âˆ’7Ï€/3')} rad ?`, correct: m('âˆ’Ï€/3 + 2Ï€ = 5Ï€/3'), wrong: [m('Ï€/3'), m('7Ï€/3'), m('4Ï€/3')],
    explain: `${m('âˆ’7Ï€/3 + 4Ï€ = âˆ’7Ï€/3 + 12Ï€/3 = 5Ï€/3')}, qui est dans ${m('[0;2Ï€[')}.` },
  { q: `Quel angle de ${m('[0 ; 2Ï€[')} est coterminÃ© Ã  ${m('9Ï€/4')} ?`, correct: m('Ï€/4'), wrong: [m('3Ï€/4'), m('5Ï€/4'), m('7Ï€/4')],
    explain: `${m('9Ï€/4 âˆ’ 2Ï€ = Ï€/4')}, qui est bien dans ${m('[0;2Ï€[')}.` },
  { q: `Quel angle de ${m('[âˆ’Ï€ ; Ï€[')} correspond Ã  ${m('5Ï€/4')} ?`, correct: m('âˆ’3Ï€/4'), wrong: [m('3Ï€/4'), m('5Ï€/4'), m('âˆ’Ï€/4')],
    explain: `${m('5Ï€/4 âˆ’ 2Ï€ = âˆ’3Ï€/4')}, qui est dans ${m('[âˆ’Ï€;Ï€[')}.` },
  { q: `Quel angle de ${m('[0 ; 2Ï€[')} correspond Ã  ${m('âˆ’5Ï€/6')} ?`, correct: m('7Ï€/6'), wrong: [m('5Ï€/6'), m('âˆ’5Ï€/6'), m('11Ï€/6')],
    explain: `${m('âˆ’5Ï€/6 + 2Ï€ = 7Ï€/6')}, qui est dans ${m('[0;2Ï€[')}.` },
  { q: `Quel angle de ${m('[0 ; 2Ï€[')} correspond Ã  ${m('17Ï€/4')} ?`, correct: m('Ï€/4'), wrong: [m('Ï€/2'), m('3Ï€/4'), m('5Ï€/4')],
    explain: `${m('17Ï€/4 âˆ’ 4Ï€ = Ï€/4')} (on retire 2Ã—2Ï€).` },
  { q: `Quel angle de ${m('[âˆ’Ï€ ; Ï€[')} correspond Ã  ${m('7Ï€/4')} ?`, correct: m('âˆ’Ï€/4'), wrong: [m('Ï€/4'), m('3Ï€/4'), m('âˆ’3Ï€/4')],
    explain: `${m('7Ï€/4 âˆ’ 2Ï€ = âˆ’Ï€/4')}, qui est dans ${m('[âˆ’Ï€;Ï€[')}.` },
  { q: `Quel angle de ${m('[0 ; 2Ï€[')} correspond Ã  ${m('âˆ’11Ï€/6')} ?`, correct: m('Ï€/6'), wrong: [m('11Ï€/6'), m('5Ï€/6'), m('7Ï€/6')],
    explain: `${m('âˆ’11Ï€/6 + 2Ï€ = Ï€/6')}.` },
  { q: `Quel est l'angle associÃ© Ã  ${m('cos(13Ï€/4)')} dont la valeur de cosinus est connue ?`, correct: m('cos(Ï€/4) = âˆš2/2'), wrong: [m('cos(3Ï€/4) = âˆ’âˆš2/2'), m('cos(Ï€/2) = 0'), m('cos(Ï€) = âˆ’1')],
    explain: `${m('13Ï€/4 âˆ’ 2Ï€ = 5Ï€/4')}, puis ${m('cos(5Ï€/4) = cos(Ï€+Ï€/4) = âˆ’cos(Ï€/4)')}. Hmm, reprenons : 13Ï€/4 = 3Ï€ + Ï€/4, donc ${m('cos(13Ï€/4) = cos(3Ï€+Ï€/4) = cos(Ï€+Ï€+Ï€/4) = âˆ’cos(Ï€+Ï€/4) = âˆ’(âˆ’cos(Ï€/4)) = cos(Ï€/4) = âˆš2/2')}.` },
];

// --- Conversions rad â†” degrÃ©s ---
const conversionQs = [
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('Ï€/3')} rad ?`, correct: '60Â°', wrong: ['30Â°', '45Â°', '90Â°'],
    explain: `${m('Ï€/3 Ã— (180/Ï€) = 60Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('Ï€/4')} rad ?`, correct: '45Â°', wrong: ['30Â°', '60Â°', '90Â°'],
    explain: `${m('Ï€/4 Ã— (180/Ï€) = 45Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('Ï€/6')} rad ?`, correct: '30Â°', wrong: ['45Â°', '60Â°', '15Â°'],
    explain: `${m('Ï€/6 Ã— (180/Ï€) = 30Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('2Ï€/3')} rad ?`, correct: '120Â°', wrong: ['60Â°', '90Â°', '150Â°'],
    explain: `${m('2Ï€/3 Ã— (180/Ï€) = 120Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('3Ï€/4')} rad ?`, correct: '135Â°', wrong: ['120Â°', '150Â°', '90Â°'],
    explain: `${m('3Ï€/4 Ã— (180/Ï€) = 135Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('5Ï€/6')} rad ?`, correct: '150Â°', wrong: ['120Â°', '135Â°', '160Â°'],
    explain: `${m('5Ï€/6 Ã— (180/Ï€) = 150Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('5Ï€/4')} rad ?`, correct: '225Â°', wrong: ['200Â°', '210Â°', '240Â°'],
    explain: `${m('5Ï€/4 Ã— (180/Ï€) = 225Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('7Ï€/6')} rad ?`, correct: '210Â°', wrong: ['200Â°', '220Â°', '240Â°'],
    explain: `${m('7Ï€/6 Ã— (180/Ï€) = 210Â°')}` },
  { q: `Ã€ quelle mesure en degrÃ©s correspond ${m('âˆ’Ï€/3')} rad ?`, correct: 'âˆ’60Â°', wrong: ['60Â°', 'âˆ’30Â°', 'âˆ’45Â°'],
    explain: `${m('âˆ’Ï€/3 Ã— (180/Ï€) = âˆ’60Â°')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 60Â° ?`, correct: m('Ï€/3'), wrong: [m('Ï€/6'), m('Ï€/4'), m('Ï€/2')],
    explain: `${m('60Â° Ã— (Ï€/180) = Ï€/3')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 90Â° ?`, correct: m('Ï€/2'), wrong: [m('Ï€/3'), m('Ï€/4'), m('2Ï€/3')],
    explain: `${m('90Â° Ã— (Ï€/180) = Ï€/2')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 45Â° ?`, correct: m('Ï€/4'), wrong: [m('Ï€/3'), m('Ï€/6'), m('Ï€/8')],
    explain: `${m('45Â° Ã— (Ï€/180) = Ï€/4')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 270Â° ?`, correct: m('3Ï€/2'), wrong: [m('Ï€'), m('2Ï€'), m('5Ï€/3')],
    explain: `${m('270Â° Ã— (Ï€/180) = 3Ï€/2')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 135Â° ?`, correct: m('3Ï€/4'), wrong: [m('2Ï€/3'), m('5Ï€/6'), m('Ï€/4')],
    explain: `${m('135Â° Ã— (Ï€/180) = 3Ï€/4')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 150Â° ?`, correct: m('5Ï€/6'), wrong: [m('3Ï€/4'), m('2Ï€/3'), m('7Ï€/6')],
    explain: `${m('150Â° Ã— (Ï€/180) = 5Ï€/6')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 240Â° ?`, correct: m('4Ï€/3'), wrong: [m('3Ï€/4'), m('5Ï€/4'), m('7Ï€/6')],
    explain: `${m('240Â° Ã— (Ï€/180) = 4Ï€/3')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 315Â° ?`, correct: m('7Ï€/4'), wrong: [m('5Ï€/4'), m('3Ï€/2'), m('11Ï€/6')],
    explain: `${m('315Â° Ã— (Ï€/180) = 7Ï€/4')}` },
  { q: `Ã€ quelle mesure en ${m('rad')} comprise dans ${m('[0;2Ï€[')} correspond 30Â° ?`, correct: m('Ï€/6'), wrong: [m('Ï€/4'), m('Ï€/3'), m('Ï€/12')],
    explain: `${m('30Â° Ã— (Ï€/180) = Ï€/6')}` },
];

// ======================================================
//  LOGIQUE DU QUIZ
// ======================================================

const themeMap = {
  symetrie: { label: 'SymÃ©tries', qs: symetryRules, color: '#f06292' },
  valeurs:  { label: 'Valeurs cos/sin', qs: valuesQs, color: '#4fc3f7' },
  reduction:{ label: 'RÃ©duction d\'angles', qs: reductionQs, color: '#ffa726' },
  conversion:{ label: 'Conversions rad/Â°', qs: conversionQs, color: '#66bb6a' },
};



let selectedThemes = ['reduction','valeurs','symetrie','conversion'];
let totalQ = 10;
let questions = [];
let current = 0;
let score = 0;
let themeScores = {};

// Shuffle
function shuffle(arr) {
  let a = [...arr];
  for (let i=a.length-1;i>0;i--) {
    let j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function buildQuestions(n) {
  // Gather from selected themes
  let pool = [];
  selectedThemes.forEach(t => {
    themeMap[t].qs.forEach(q => pool.push({...q, theme: t}));
  });
  pool = shuffle(pool);
  return pool.slice(0, n);
}

function initScores() {
  themeScores = {};
  selectedThemes.forEach(t => { themeScores[t] = {correct:0, total:0}; });
}

// DOM refs
const setupScreen = document.getElementById('setup-screen');
const quizScreen = document.getElementById('quiz-screen');
const resultsScreen = document.getElementById('results-screen');
const startBtn = document.getElementById('start-btn');
const nextBtn = document.getElementById('next-btn');
const restartBtn = document.getElementById('restart-btn');

// Theme buttons
document.querySelectorAll('.theme-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const t = btn.dataset.theme;
    if (btn.classList.contains('active')) {
      if (selectedThemes.length > 1) {
        btn.classList.remove('active');
        selectedThemes = selectedThemes.filter(x=>x!==t);
      }
    } else {
      btn.classList.add('active');
      selectedThemes.push(t);
    }
  });
});

// Qty buttons
document.querySelectorAll('.qty-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.qty-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    totalQ = parseInt(btn.dataset.qty);
  });
});

startBtn.addEventListener('click', startQuiz);
nextBtn.addEventListener('click', nextQuestion);
restartBtn.addEventListener('click', () => {
  resultsScreen.style.display = 'none';
  setupScreen.style.display = 'block';
  quizScreen.style.display = 'none';
});

function startQuiz() {
  questions = buildQuestions(totalQ);
  if (questions.length === 0) return;
  totalQ = questions.length;
  current = 0;
  score = 0;
  initScores();
  setupScreen.style.display = 'none';
  quizScreen.style.display = 'block';
  showQuestion();
}

function showQuestion() {
  const q = questions[current];
  document.getElementById('q-counter').textContent = `Question ${current+1} / ${totalQ}`;
  document.getElementById('score-display').textContent = `Score : ${score}`;
  document.getElementById('progress-bar').style.width = `${(current/totalQ)*100}%`;

  const typeLabel = themeMap[q.theme]?.label || '';
  document.getElementById('q-type').textContent = typeLabel;
  document.getElementById('q-type').style.color = themeMap[q.theme]?.color || '#aaa';
  document.getElementById('q-text').innerHTML = q.q;

  const feedback = document.getElementById('feedback-box');
  feedback.className = 'feedback-box';
  feedback.innerHTML = '';

  nextBtn.style.display = 'none';

  // Build shuffled answers
  const answers = shuffle([
    {text: q.correct, isCorrect: true},
    ...q.wrong.map(w => ({text: w, isCorrect: false}))
  ]);

  const grid = document.getElementById('answers-grid');
  grid.innerHTML = '';
  const labels = ['A', 'B', 'C', 'D'];
  answers.forEach((ans, i) => {
    const btn = document.createElement('button');
    btn.className = 'answer-btn';
    btn.dataset.correct = ans.isCorrect ? 'true' : 'false';
    btn.innerHTML = `<span class="answer-label">${labels[i]}</span>${ans.text}`;
    btn.addEventListener('click', () => selectAnswer(ans.isCorrect, btn, answers, q));
    grid.appendChild(btn);
  });
}

function selectAnswer(isCorrect, clickedBtn, answers, q) {
  // Disable all
  const btns = document.querySelectorAll('.answer-btn');
  btns.forEach(b => b.disabled = true);

  // Track theme score
  if (q.theme && themeScores[q.theme]) {
    themeScores[q.theme].total++;
    if (isCorrect) themeScores[q.theme].correct++;
  }

  if (isCorrect) {
    clickedBtn.classList.add('correct');
    score++;
  } else {
    clickedBtn.classList.add('wrong');
    // Reveal correct button
    btns.forEach(b => {
      if (b.dataset.correct === 'true') b.classList.add('reveal-correct');
    });
  }

  // Show feedback
  const feedback = document.getElementById('feedback-box');
  feedback.className = `feedback-box visible ${isCorrect ? 'correct-fb' : 'wrong-fb'}`;
  feedback.innerHTML = `<strong>${isCorrect ? 'âœ“ Correct !' : 'âœ— RatÃ©.'}</strong> ${q.explain}`;

  document.getElementById('score-display').textContent = `Score : ${score}`;
  nextBtn.style.display = 'block';
  nextBtn.textContent = current < totalQ - 1 ? 'Question suivante â†’' : 'Voir les rÃ©sultats â†’';
}

function nextQuestion() {
  current++;
  if (current >= totalQ) {
    showResults();
  } else {
    showQuestion();
  }
}

function showResults() {
  quizScreen.style.display = 'none';
  resultsScreen.style.display = 'block';
  document.getElementById('progress-bar').style.width = '100%';

  document.getElementById('final-score-num').textContent = score;
  document.getElementById('final-score-denom').textContent = `/ ${totalQ}`;

  const pct = score / totalQ;
  let title, sub;
  if (pct >= 0.9) { title = 'Excellent ! ðŸŽ‰'; sub = 'Tu maÃ®trises bien ces angles remarquables.'; }
  else if (pct >= 0.7) { title = 'Bien jouÃ© !'; sub = 'Encore un peu d\'entraÃ®nement pour viser l\'excellence.'; }
  else if (pct >= 0.5) { title = 'Pas mal.'; sub = 'Tu progresses. RÃ©vise les formules de symÃ©trie.'; }
  else { title = 'Ã€ retravailler.'; sub = 'Reprends le cours et rÃ©essaie !'; }

  document.getElementById('result-title').textContent = title;
  document.getElementById('result-subtitle').textContent = sub;

  // Breakdown
  const bd = document.getElementById('breakdown');
  bd.innerHTML = '<h3>Par thÃ¨me</h3>';
  selectedThemes.forEach(t => {
    const s = themeScores[t];
    if (!s || s.total === 0) return;
    const p = s.correct / s.total;
    const cls = p >= 0.7 ? 'good' : p >= 0.5 ? 'ok' : 'bad';
    const icon = p >= 0.7 ? 'âœ“' : p >= 0.5 ? '~' : 'âœ—';
    bd.innerHTML += `<div class="breakdown-item">
      <span>${themeMap[t].label}</span>
      <span class="bi-score ${cls}">${icon} ${s.correct}/${s.total}</span>
    </div>`;
  });
}
</script>
</body>
</html>
