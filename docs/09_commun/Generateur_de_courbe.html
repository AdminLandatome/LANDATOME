<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interpolation d'Hermite Dynamique</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background-color: #f8f9fa; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .point-row { display: flex; gap: 15px; margin-bottom: 12px; align-items: center; padding: 10px; border-radius: 8px; transition: 0.2s; }
        .point-row.disabled { opacity: 0.4; background-color: #f1f1f1; }
        .point-row:hover:not(.disabled) { background-color: #f0f7ff; }
        input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 90px; }
        .btn-calc { background-color: #3498db; color: white; font-weight: bold; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; }
        .btn-calc:hover { background-color: #2980b9; }
        #result-area { margin-top: 15px; padding: 15px; background: #fdfdfd; border: 1px dashed #3498db; border-left: 5px solid #3498db; word-break: break-all; font-family: 'Courier New', Courier, monospace; font-size: 14px; }
        .copy-section { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; margin-top: 15px; }
        .btn-copy { background-color: #2ecc71; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; }
        #plot { width: 100%; height: 450px; }
        label { font-weight: bold; color: #34495e; }
        .checkbox-custom { transform: scale(1.3); cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2>Générateur de Courbe d'Hermite</h2>
    <p style="color: #7f8c8d; font-size: 0.9em;">Cochez les points que vous souhaitez utiliser (minimum 2).</p>

    <div id="inputs-list">
        </div>

    <button class="btn-calc" onclick="generer()">Calculer et mettre à jour l'aperçu</button>
</div>

<div id="result-container" class="container" style="display:none;">
    <label>Équation GeoGebra :</label>
    <div id="result-area"></div>
    <div class="copy-section">
        <button class="btn-copy" onclick="copier()">Copier l'équation</button>
    </div>
</div>

<div id="plot-container" class="container" style="display:none;">
    <div id="plot"></div>
</div>

<script>
    const MAX_POINTS = 5;
    const listContainer = document.getElementById('inputs-list');

    // Initialisation des lignes
    for (let i = 0; i < MAX_POINTS; i++) {
        const isChecked = i < 2 ? 'checked' : ''; // On active les 2 premiers par défaut
        const isDisabled = i < 2 ? '' : 'disabled';
        
        listContainer.innerHTML += `
            <div class="point-row ${isDisabled}" id="row${i}">
                <input type="checkbox" class="checkbox-custom" id="check${i}" ${isChecked} onchange="toggleRow(${i})">
                <label>Point ${i+1} :</label>
                x <input type="number" step="any" id="x${i}" value="${i*2}">
                y <input type="number" step="any" id="y${i}" value="${(i*i)%5}">
                pente m <input type="number" step="any" id="m${i}" value="${i === 0 ? 1 : -1}">
            </div>
        `;
    }

    function toggleRow(i) {
        const row = document.getElementById(`row${i}`);
        const isChecked = document.getElementById(`check${i}`).checked;
        if (isChecked) row.classList.remove('disabled');
        else row.classList.add('disabled');
    }

    function evaluatePolynomial(x_eval, coefs, z, n) {
        let y = coefs[0];
        let term = 1;
        for (let j = 1; j < n; j++) {
            term *= (x_eval - z[j-1]);
            y += coefs[j] * term;
        }
        return y;
    }

    function generer() {
        let x_vals = [], y_vals = [], m_vals = [];

        for (let i = 0; i < MAX_POINTS; i++) {
            if (document.getElementById(`check${i}`).checked) {
                x_vals.push(parseFloat(document.getElementById(`x${i}`).value || 0));
                y_vals.push(parseFloat(document.getElementById(`y${i}`).value || 0));
                m_vals.push(parseFloat(document.getElementById(`m${i}`).value || 0));
            }
        }

        if (x_vals.length < 2) {
            alert("Il faut au moins 2 points actifs.");
            return;
        }

        const n = x_vals.length;
        let z = [];
        for (let i = 0; i < n; i++) z.push(x_vals[i], x_vals[i]);

        let numP = 2 * n;
        let d = Array.from({ length: numP }, () => new Array(numP).fill(0));

        for (let i = 0; i < n; i++) {
            d[2*i][0] = y_vals[i];
            d[2*i+1][0] = y_vals[i];
        }

        for (let j = 1; j < numP; j++) {
            for (let i = 0; i < numP - j; i++) {
                if (j === 1 && i % 2 === 0) {
                    d[i][j] = m_vals[Math.floor(i / 2)];
                } else {
                    let dx = z[i + j] - z[i];
                    d[i][j] = (Math.abs(dx) < 1e-10) ? m_vals[Math.floor(i / 2)] : (d[i + 1][j - 1] - d[i][j - 1]) / dx;
                }
            }
        }

        let coefs = d[0];
        let eq = `f(x) = ${coefs[0].toFixed(4)}`;
        let prod = "";
        for (let j = 1; j < numP; j++) {
            prod += `*(x - (${z[j-1]}))`;
            if (Math.abs(coefs[j]) > 1e-9) {
                eq += ` ${coefs[j] >= 0 ? '+' : ''} ${coefs[j].toFixed(4)}${prod}`;
            }
        }

        document.getElementById('result-area').innerText = eq;
        document.getElementById('result-container').style.display = 'block';
        document.getElementById('plot-container').style.display = 'block';

        // Plotly
        let minX = Math.min(...x_vals), maxX = Math.max(...x_vals);
        let span = maxX - minX || 1;
        let px = [], py = [];
        for (let t = minX - span*0.2; t <= maxX + span*0.2; t += span*1.4/200) {
            px.push(t); py.push(evaluatePolynomial(t, coefs, z, numP));
        }

        Plotly.newPlot('plot', [
            { x: px, y: py, mode: 'lines', name: 'Courbe', line: {color: '#3498db'} },
            { x: x_vals, y: y_vals, mode: 'markers', name: 'Points', marker: {color: '#e74c3c', size: 10} }
        ], { margin: { t: 30 } });
    }

    function copier() {
        navigator.clipboard.writeText(document.getElementById('result-area').innerText);
        alert("Copié !");
    }
</script>
</body>
</html>